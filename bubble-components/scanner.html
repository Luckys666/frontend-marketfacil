<!-- 
  BUBBLE.IO COMPONENT: SCANNER WIDGET
  Repository: Luckys666/frontend-marketfacil
  
  INSTRUCTIONS:
  1. Copy this entire code block.
  2. Paste it into an "HTML Element" in your Bubble app.
  3. Ensure "Display as an iframe" is UNCHECKED (unless you handle sizing manually).
-->

<!-- CSS do Widget -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Luckys666/frontend-marketfacil@latest/css/core.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Luckys666/frontend-marketfacil@latest/css/analyzer.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Luckys666/frontend-marketfacil@latest/css/scanner.css">

<!-- COMPONENT WRAPPER -->
<div class="mf-dashboard-wrapper">
    <div class="ml-analyzer-widget">
        <!-- Controls -->
        <div class="input-area" style="display: flex; gap: 15px; flex-wrap: wrap; align-items: flex-end;">
            <div style="flex-grow: 1;">
                <label for="tagFilter" class="text-label" style="display:block; margin-bottom:5px;">Filtrar por
                    Tag:</label>
                <select id="tagFilter" onchange="handleScannerFilterChange()"
                    style="width: 100%; padding: 12px; border: 1px solid #e2e8f0; border-radius: 8px;">
                    <option value="all">Ver Tudo (Inicie o Scanner)</option>
                </select>
            </div>
            <div style="display: flex; align-items: flex-end; gap: 10px;">
                <button id="scanButton" onclick="startAccountScan()" style="height: 42px;">Escanear Conta</button>
                <button id="exportCsvButton" onclick="exportToCSV()"
                    style="height: 42px; background: #fff !important; color: #3b82f6; border: 1px solid #3b82f6 !important; white-space: nowrap;"
                    title="Gerar planilha com todos os anúncios e problemas encontrados">📊 Exportar Relatório</button>
            </div>
        </div>

        <!-- Progress Bar -->
        <div id="scanProgress" style="display: none; margin: 20px 0;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                <span id="scanStatusText" class="text-small" style="font-weight: 600;">Iniciando...</span>
                <span id="scanCountText" class="text-small">0 encontrados</span>
            </div>
            <div class="char-counter-bar">
                <div id="scanProgressBar" class="char-progress" style="width: 0%; background: #3b82f6;"></div>
            </div>
        </div>

        <!-- Tag Legend -->
        <div id="tagLegend"
            style="display: none; margin-top: 16px; padding: 10px 14px; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 0.8rem; color: #64748b; flex-wrap: wrap; align-items: center; gap: 4px;">
            <span style="font-weight: 600; margin-right: 12px;">Legenda:</span>
            <span class="status-badge error" style="font-size: 0.7rem; vertical-align: middle;">Problema</span>
            <span style="margin: 0 6px;">= Erro que precisa de atenção</span>
            <span class="status-badge muted"
                style="margin-left: 12px; font-size: 0.7rem; vertical-align: middle;">Neutra</span>
            <span style="margin: 0 6px;">= Informação sem impacto negativo</span>
        </div>

        <!-- Results Area -->
        <div id="scannerResults"
            style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; margin-top: 20px;">
            <div class="ana-card initial-placeholder"
                style="grid-column: 1 / -1; text-align: center; color: #94a3b8; padding: 40px;">
                Selecione um filtro e clique em "Escanear Conta" para começar.
            </div>
        </div>

        <!-- Pagination Controls -->
        <div id="scannerPagination"
            style="display: none; margin-top: 16px; padding: 12px; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; align-items: center; justify-content: center; gap: 12px; text-align: center;">
        </div>
    </div>
</div>

<!-- JS do Widget (carregado via jsDelivr CDN) -->
<script src="https://cdn.jsdelivr.net/gh/Luckys666/frontend-marketfacil@latest/js/analyzer.js"></script>
<script src="https://cdn.jsdelivr.net/gh/Luckys666/frontend-marketfacil@latest/js/scanner.js"></script>