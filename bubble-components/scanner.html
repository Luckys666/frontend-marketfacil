<!-- 
  BUBBLE.IO COMPONENT: ACCOUNT SCANNER WIDGET
  Repository: Luckys666/frontend-marketfacil
  
  Description: Scans all products in the account and filters by tags.
-->

<!-- CSS (Shared with Ad Analyzer) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Luckys666/frontend-marketfacil@latest/style.css?v=2.1">

<div class="mf-dashboard-wrapper">
    <div class="ml-analyzer-widget">
        <!-- Controls -->
        <div class="input-area" style="display: flex; gap: 15px; flex-wrap: wrap; align-items: flex-end;">
            <div style="flex-grow: 1;">
                <label for="tagFilter" class="text-label" style="display:block; margin-bottom:5px;">Filtrar por
                    Tag:</label>
                <select id="tagFilter" onchange="handleScannerFilterChange()"
                    style="width: 100%; padding: 12px; border: 1px solid #e2e8f0; border-radius: 8px;">
                    <option value="all">Ver Tudo (Inicie o Scanner)</option>
                </select>
            </div>
            <div style="display: flex; align-items: flex-end; gap: 10px;">
                <button id="scanButton" onclick="startAccountScan()" style="height: 42px;">Escanear Conta</button>
                <button id="exportCsvButton" onclick="exportToCSV()"
                    style="height: 42px; background: #fff !important; color: #3b82f6; border: 1px solid #3b82f6 !important;"
                    title="Exportar resultados atuais para planilha">ðŸ“¥ CSV</button>
            </div>
        </div>

        <!-- Progress Bar -->
        <div id="scanProgress" style="display: none; margin: 20px 0;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                <span id="scanStatusText" class="text-small" style="font-weight: 600;">Iniciando...</span>
                <span id="scanCountText" class="text-small">0 encontrados</span>
            </div>
            <div class="char-counter-bar">
                <div id="scanProgressBar" class="char-progress" style="width: 0%; background: #3b82f6;"></div>
            </div>
        </div>

        <!-- Results Area -->
        <div id="scannerResults"
            style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; margin-top: 20px;">
            <!-- Cards will be injected here -->
            <div class="ana-card initial-placeholder"
                style="grid-column: 1 / -1; text-align: center; color: #94a3b8; padding: 40px;">
                Selecione um filtro e clique em "Escanear Conta" para comeÃ§ar.
            </div>
        </div>
    </div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/gh/Luckys666/frontend-marketfacil@latest/js/analyzer.js?v=2.1"></script>
<script src="https://cdn.jsdelivr.net/gh/Luckys666/frontend-marketfacil@latest/js/scanner.js?v=2.1"></script>